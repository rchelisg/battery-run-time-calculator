/* ─────────────────────────────────────────────
   Battery Run Time Calculator — styles.css
   Mobile-first design, optimised for iPhone 14/15/16/17
   ───────────────────────────────────────────── */

/* ── Reset ─────────────────────────────────── */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* ── Design tokens ──────────────────────────── */
:root {
  --color-primary:        #4CAF50;   /* green */
  --color-primary-dark:   #388E3C;
  --color-bg:             #F5F5F5;
  --color-card:           #FFFFFF;
  --color-text:           #212121;
  --color-text-secondary: #757575;
  --color-border:         #E0E0E0;

  --font-size-base: 16px;   /* 16 px min prevents iOS auto-zoom on inputs */
  --font-size-sm:   0.875rem;
  --font-size-lg:   1.25rem;
  --font-size-xl:   1.5rem;

  --spacing-xs: 0.5rem;
  --spacing-sm: 0.75rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;

  --border-radius: 0;
  --shadow:        0 2px 8px rgba(0, 0, 0, 0.10);
}

/* ── Base ───────────────────────────────────── */
html {
  /* Prevent horizontal scroll on every screen size */
  overflow-x: hidden;
  width: 100%;
  /* Prevent iOS Safari from auto-scaling text (e.g. in compact inputs) */
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* Remove browser up/down spinner arrows from all number inputs */
/* Users enter values directly — arrows are unnecessary on mobile */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type="number"] {
  -moz-appearance: textfield;  /* Firefox */
  appearance: textfield;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
               Helvetica, Arial, sans-serif;
  font-size: var(--font-size-base);
  line-height: 1.5;
  background-color: var(--color-bg);
  color: var(--color-text);
  min-height: 100vh;
  overflow-x: hidden;

  /* Handle iPhone notch (top) and home indicator (bottom) */
  padding-top:    env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left:   env(safe-area-inset-left);
  padding-right:  env(safe-area-inset-right);
}

/* ── App container ──────────────────────────── */
/* Centre content; cap width for tablets/desktops */
.app-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  max-width: 600px;
  margin: 0 auto;
  padding: 0 var(--spacing-md);
}

/* ── Header ─────────────────────────────────── */
.app-header {
  background-color: #1976D2;         /* blue */
  color: #ffffff;
  text-align: center;
  padding: 0.5rem var(--spacing-lg); /* slightly reduced from 1rem */
  /* Bleed edge-to-edge ignoring the container's horizontal padding */
  margin-left:  calc(-1 * var(--spacing-md));
  margin-right: calc(-1 * var(--spacing-md));
}

.app-header h1 {
  font-size: 1.05rem;                /* slightly reduced from 1.25rem */
  font-weight: 600;
  letter-spacing: 0.01em;
  color: #ffffff;                    /* default = offline = white */
}

/* Title bar status colours — toggled via JS class on h1 */
.app-header h1.status-online { color: #69F0AE; }  /* bright green on blue */
.app-header h1.status-error  { color: #FF5252; }  /* bright red on blue  */

/* ── Main content ───────────────────────────── */
.app-main {
  flex: 1;                         /* push footer to bottom */
  padding: 0.3rem 0;               /* minimal top gap — nav bar sits just above first card */
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* ── Card ───────────────────────────────────── */
.card {
  background-color: var(--color-card);
  border-radius: var(--border-radius);
  padding: var(--spacing-lg);
  box-shadow: var(--shadow);
}

.card h2 {
  font-size: var(--font-size-xl);
  color: var(--color-primary);
  margin-bottom: var(--spacing-sm);
}

.card p {
  color: var(--color-text-secondary);
  line-height: 1.6;
}


/* ── Field rows (shared by PACK and future cards) ── */

/* One row: label + input area, separated by a light divider */
.field-row {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) 0;
  border-bottom: 1px solid var(--color-border);
}

.field-row:last-child {
  border-bottom: none;
}

/* Fixed-width label on the left */
.field-label {
  flex: 0 0 5.5rem;
  font-weight: 500;
  color: var(--color-text);
  font-size: var(--font-size-base);
  padding-top: 0.55rem; /* vertically align with input text */
}

/* Right column: stacks the input-row and the error message */
.field-input-wrap {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* Horizontal row of input + optional unit label */
.field-input-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

/* The number input itself */
.field-input {
  flex: 1;
  min-width: 0;           /* allow shrinking inside flex */
  padding: 0.55rem var(--spacing-sm);
  font-size: var(--font-size-base);  /* 16 px — prevents iOS auto-zoom */
  color: var(--color-text);
  background: #fff;
  border: 1.5px solid var(--color-border);
  border-radius: 8px;
  appearance: none;
  -webkit-appearance: none;
  outline: none;
  transition: border-color 0.15s;
  /* Ensure touch target is at least 44 px tall */
  min-height: 44px;
}

.field-input:focus {
  border-color: var(--color-primary);
}

/* Red border when a field has a validation error */
.field-input.input-error {
  border-color: #CC0000;
}

/* Unit label (mAh, W, h …) to the right of the input */
.field-unit {
  flex-shrink: 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  white-space: nowrap;
}

/* Inline error message below the input row */
.field-error {
  font-size: var(--font-size-sm);
  color: #CC0000;
  margin-top: 0.2rem;
  min-height: 1rem;  /* reserve space so layout doesn't jump */
  line-height: 1.3;
}

/* ── PACK card — rotated title + compact field row ── */

/* Card layout: [PACK title vertical] | [fields + error] */
.pack-card {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--spacing-sm);
  padding: 0.15rem var(--spacing-sm); /* minimal top/bottom — maximum compactness */
}

/* Vertical "PACK" title — rotated 180° so text reads bottom → top */
.pack-card h2 {
  -webkit-writing-mode: vertical-rl; /* iOS Safari requires the prefix */
  writing-mode: vertical-rl;        /* characters flow top → bottom first… */
  transform: rotate(180deg);        /* …then flip so they read upward */
  font-size: 0.95rem;
  font-weight: 700;                 /* bold */
  color: var(--color-primary);
  margin-bottom: 0;                 /* override .card h2 margin */
  letter-spacing: 0.08em;
  align-self: center;
  user-select: none;
}

/* Right-side column holding the input row and error strip */
.pack-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
}

/* Horizontal container holding all four pack columns */
.pack-row {
  display: flex;
  gap: var(--spacing-xs);    /* tight gap between columns */
  align-items: flex-start;
  margin-top: 0;             /* no top gap — h2 is now beside, not above */
}

/* Each column: label → input → unit, stacked vertically — fixed width */
.pack-field {
  flex: 0 0 auto;            /* fixed width — don't grow to fill row */
  min-width: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

/* Extra right margin on Nominal — guarantees a minimum gap before Min/Max group */
.pack-field-nominal {
  margin-right: 0.4rem;
}

/* Min+Max group — margin-left:auto pushes it to the right edge;
   gap between Nominal and Min auto-adjusts with screen width              */
.pack-minmax-group {
  margin-left: auto;
  display: flex;
  gap: var(--spacing-xs);
  align-items: flex-start;
}

/* Small column heading above each input */
.pack-label {
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--color-text-secondary);
  text-align: center;
  margin-bottom: 0.05rem;  /* tighter gap between label and input */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 3.6rem;            /* align label over input (matches pack-input-c width) */
}

/* Compact input — overrides base .field-input sizing */
.pack-input {
  flex: none;                       /* override flex:1 from .field-input */
  text-align: center;
  padding: 0.08rem 0.2rem;          /* further reduced for compactness */
  min-height: 26px;                 /* tighter than default 44px */
  font-size: var(--font-size-base); /* explicit 16px — prevent iOS auto-scaling */
  width: 2.8rem;                    /* fixed: enough for 4 digits */
}

/* Narrow column for the single-digit N (Cells) field */
.pack-field-narrow {
  flex: 0 0 auto;            /* don't grow — fixed narrow width */
}

.pack-field-narrow .pack-input {
  width: 2.2rem;             /* narrower: just wide enough for one digit */
}

.pack-field-narrow .pack-label {
  width: 2.2rem;             /* override: narrower label for the Cells (N) column */
}

/* Wider input for the three capacity fields (C, Cmin, Cmax) — extra 1–2 digit room */
.pack-input-c { width: 3.6rem; }

/* Inline row: input + unit side by side */
.pack-input-row {
  display: flex;
  align-items: center;
  gap: 0.2rem;
}

/* Unit label inline to the right of the input */
.pack-unit {
  font-size: 0.7rem;
  color: var(--color-text-secondary);
  white-space: nowrap;
  flex-shrink: 0;
}

/* Invisible spacer — matches LOAD's +/- strip width (1.0 rem);
   keeps Cmax and Lmax right edges vertically aligned across cards  */
.pack-ctrl-spacer {
  flex-shrink: 0;
  width: 1.0rem;
}

/* Shared error strip — full content width, fixed height, never shifts card size */
/* Specificity .pack-card .pack-error (0,2,0) beats .card p (0,1,1) → correct red */
.pack-card .pack-error {
  height: 1rem;            /* fixed: always reserves exactly one text line */
  overflow: hidden;        /* clip if somehow overflows */
  margin-top: 0.1rem;      /* minimal gap above error strip */
  font-size: 0.7rem;
  color: #CC0000;
  line-height: 1.4;
}

/* ── Nav bar ────────────────────────────────── */
/* Row of 4 equally-wide tappable tab buttons */
.nav-bar {
  display: flex;
  background-color: var(--color-card);
  border-bottom: 2px solid var(--color-border);
  /* Bleed edge-to-edge like the app-header */
  margin-left:  calc(-1 * var(--spacing-md));
  margin-right: calc(-1 * var(--spacing-md));
}

.nav-btn {
  flex: 1;
  min-height: 44px;           /* iOS minimum touch target */
  border: none;
  border-bottom: 3px solid transparent;
  background: transparent;
  font-family: inherit;
  font-size: var(--font-size-base);
  font-weight: 500;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: 0.4rem 0;
  touch-action: manipulation;
  user-select: none;
  transition: color 0.15s, border-color 0.15s;
}

.nav-btn.active {
  color: #1976D2;
  border-bottom-color: #1976D2;
  font-weight: 600;
}

.nav-btn:active {
  background-color: var(--color-bg);
}

/* ── Page containers — show/hide based on active nav tab ── */
/* Each page is a flex column with standard card gap            */
.page {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.page.page-hidden {
  display: none;
}

/* Extra top margin on REPORT TIME card within PAGE Calc —
   creates 2× the normal inter-card gap after the last LOAD card */
#page-calc .report-time-card {
  margin-top: var(--spacing-md);
}

/* ── Footer ─────────────────────────────────── */
.app-footer {
  text-align: center;
  padding: var(--spacing-md);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  border-top: 1px solid var(--color-border);
  margin-top: var(--spacing-md);
}

/* ── LOAD group — summary + LOAD x cards in a tightly-spaced column ── */
/* Gap = 1/3 of the standard inter-card gap (--spacing-md = 1rem) */
.load-group {
  display: flex;
  flex-direction: column;
  gap: calc(var(--spacing-md) / 3);
}

/* ── LOAD cards container ───────────────────── */
/* Same tight gap between adjacent LOAD x cards */
#load-cards-container {
  display: flex;
  flex-direction: column;
  gap: calc(var(--spacing-md) / 3);
}

/* ── LOAD card — same compact layout as PACK ── */

/* Card layout: [LOADx label vertical] | [fields + error] | [vertical +/- strip] */
.load-card {
  display: flex;
  flex-direction: row;
  align-items: stretch;      /* stretch so +/- strip fills full card height */
  gap: var(--spacing-sm);
  padding: 0.15rem var(--spacing-sm);
}

/* Vertical "LOADx" label — same rotation as PACK */
.load-card h2 {
  -webkit-writing-mode: vertical-rl; /* iOS Safari requires the prefix */
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--color-primary);
  margin-bottom: 0;           /* override .card h2 margin */
  letter-spacing: 0.08em;
  align-self: center;
  user-select: none;
  white-space: nowrap;
}

/* Right-side column: controls + input row + error strip */
.load-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
}

/* Vertical +/- strip — right edge of card, always present for consistent width */
/* − at top, + at bottom; buttons hidden via visibility on non-last cards     */
.load-controls {
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* − pinned to top, + pinned to bottom */
  align-items: center;
  flex-shrink: 0;
  width: 1.0rem;          /* matches button width */
  padding: 0.15rem 0;     /* small breathing room at top and bottom */
}

/* Individual +/- button */
.load-btn {
  width: 1.0rem;
  height: 1.0rem;
  border: 1.5px solid var(--color-border);
  border-radius: 4px;
  background: #fff;
  color: var(--color-text);
  font-size: 0.7rem;
  line-height: 1;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  flex-shrink: 0;
  user-select: none;
  touch-action: manipulation;
}

.load-btn:hover {
  background-color: var(--color-bg);
  border-color: var(--color-primary);
}

.load-btn:active {
  background-color: var(--color-primary);
  color: #fff;
}

/* Horizontal container: Nominal | Min | Max */
.load-row {
  display: flex;
  gap: var(--spacing-xs);
  align-items: flex-start;
}

/* Each field column — fixed width, don't grow */
.load-field {
  flex: 0 0 auto;
  min-width: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

/* Extra right margin on Nominal — guarantees a minimum gap before Min/Max group */
.load-field-nominal {
  margin-right: 0.4rem;
}

/* Min+Max group — fixed left margin gives consistent ~4-digit gap after Nominal */
.load-minmax-group {
  margin-left: 1rem;
  display: flex;
  gap: var(--spacing-xs);
  align-items: flex-start;
}

/* Column heading */
.load-label {
  font-size: 0.65rem;
  font-weight: 600;
  color: var(--color-text-secondary);
  text-align: center;
  margin-bottom: 0.05rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 2.8rem;            /* align label over input (matches load-input width) */
}

/* Compact number input — same sizing as pack-input */
.load-input {
  flex: none;                       /* override flex:1 from .field-input */
  text-align: center;
  padding: 0.08rem 0.2rem;
  min-height: 16px;
  font-size: var(--font-size-base); /* explicit 16px — prevent iOS auto-scaling */
  width: 2.8rem;                    /* fixed: enough for 4 digits */
}

/* Subtle indicator for auto-computed Nominal (L) value */
.load-input.auto-populated {
  background-color: #E8F4FD;       /* light blue — indicates computed, not user-entered */
}

/* Inline row: input + unit side by side */
.load-input-row {
  display: flex;
  align-items: center;
  gap: 0.2rem;
}

/* Unit label inline to the right of the input */
.load-unit {
  font-size: 0.7rem;
  color: var(--color-text-secondary);
  white-space: nowrap;
  flex-shrink: 0;
}

/* Fixed min-width for the Max-column unit span — ensures right edges of
   all three Max inputs (Cmax / Lmax / Tmax) align vertically across cards */
.unit-max {
  min-width: 2.2rem;
}

/* Shared error strip — specificity (0,2,0) beats .card p (0,1,1) */
.load-card .load-error {
  height: 1rem;
  overflow: hidden;
  margin-top: 0.1rem;
  font-size: 0.7rem;
  color: #CC0000;
  line-height: 1.4;
}

/* ── LOAD output — table-based summary (cross-platform alignment) ── */
.load-output {
  padding: 0.35rem var(--spacing-sm);   /* compact top/bottom padding */
}

/* Full-width table; fixed layout so columns are sized by colgroup, not content */
.load-out-table {
  width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
  font-size: 0.78rem;
  /* Explicit monospace stack: Menlo (macOS/iOS) → Consolas (Windows) → fallback */
  font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
  line-height: 1.45;
}

/* Force monospace inheritance into th/td — some browsers don't cascade font into cells */
.load-out-table th,
.load-out-table td {
  font-family: inherit;
  font-size: inherit;
}

/* Column widths — proportions 7 : 10 : 5 : 5 (total 27 parts) */
.col-label { width: 26%; }   /* label column   (7 parts) */
.col-nom   { width: 37%; }   /* Nominal value  (10 parts) */
.col-rng   { width: 18.5%; } /* Min and Max    (5 parts each) */

/* Header row */
.load-out-table thead tr {
  border-bottom: 1px solid var(--color-border);
}

.load-out-th-label {
  text-align: center;
  color: var(--color-text-secondary);
  padding-bottom: 0.15rem;
  font-weight: 600;
}

.load-out-th-num {
  text-align: center;
  color: var(--color-text-secondary);
  padding-bottom: 0.15rem;
  font-weight: 600;
}

/* Data rows */
.load-out-label {
  text-align: left;
  color: var(--color-text-secondary);
  padding-right: 0.3em;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.load-out-nom,
.load-out-rng {
  text-align: right;
}

/* Colours: entry present = dark grey; no entry = light grey */
.load-out-nom.has-value,
.load-out-rng.has-value { color: #616161; }

.load-out-nom.no-value,
.load-out-rng.no-value  { color: #BDBDBD; }

/* ── Total row — separator line + bold label ── */
.load-out-total td {
  border-top: 1px solid var(--color-border);
  padding-top: 0.2rem;
}

.load-out-total-label {
  font-weight: 700;
  color: var(--color-text) !important;  /* darker than regular LOAD rows */
}

/* Auto-populated PACK capacity inputs (Cmin/Cmax seeded from C) */
.pack-input.auto-populated {
  background-color: #E8F4FD;   /* same light-blue as LOAD auto-populated */
}

/* LOAD summary card — display-only value spans (plain text, no input-box styling) */
.load-summary-val {
  display: inline-block;
  width: 2.8rem;              /* same width as load-input for consistent column alignment */
  text-align: center;
  font-size: var(--font-size-base);
  color: var(--color-text);
  font-weight: 600;           /* slightly bolder to distinguish totals from labels */
}

/* TIME card: Tmax is calculated (not user-enterable) */
.time-calc-field {
  background-color: #F5F5F5;  /* light grey — indicates read-only */
  color: var(--color-text-secondary);
  cursor: default;
}

.time-calc-field:focus {
  border-color: var(--color-border);  /* suppress focus highlight */
  outline: none;
}

/* ── REPORT TIME card — monospace formatted run time report ── */

/* Reduced padding lets wider mono text fit on narrow screens (≥ 375 px) */
.report-time-card {
  padding: var(--spacing-md);
}

/* Monospace pre block — plain text, no border, auto-scrolls if somehow wider */
.report-time-pre {
  font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
  font-size: 0.5rem;    /* uniform size — all lines same width so columns stay aligned */
  white-space: pre;     /* preserve exact spacing */
  overflow-x: auto;     /* safety scroll if content ever exceeds card width */
  margin: 0;
  line-height: 1.6;
  color: var(--color-text);
}

/* Title (.rpt-title) and Run Time (.rpt-runtime) use <strong> for bold distinction.
   No font-size override — uniform size across all lines keeps monospace columns aligned. */

/* Lx breakdown lines — light grey to distinguish from the LOAD summary total */
.report-time-pre .rpt-loadx {
  color: #BDBDBD;
}

/* ── L(x) card — extra compactness overrides for dynamically created LOAD cards ── */
/* Applied only to L(0), L(1), … cards (not the LOAD summary or TIME card)        */
.load-x-card {
  padding: 0.05rem var(--spacing-sm);
}

.load-x-card .load-error {
  height: 0.7rem;
}

/* ── Responsive scale-up for larger screens ─── */
/* Tablets and desktops (768 px and up) */
@media (min-width: 768px) {
  .app-header h1 {
    font-size: 1.2rem;
  }

  .card {
    padding: var(--spacing-xl);
  }

  /* Keep pack-card condensed on larger screens too */
  .pack-card {
    padding: 0.15rem var(--spacing-sm);
  }

  /* Keep load-card condensed on larger screens too */
  .load-card {
    padding: 0.15rem var(--spacing-sm);
  }

  /* Keep L(x) cards extra-compact on larger screens too */
  .load-x-card {
    padding: 0.05rem var(--spacing-sm);
  }
}
